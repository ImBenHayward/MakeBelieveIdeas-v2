"use strict";(()=>{function n(){return Snipcart.store.getState().customer.status==="SignedIn"?Snipcart.store.getState().customer.email:""}function E(){Snipcart.store.getState().customer.status==="SignedIn"?($(".nav-login-btn").html("Profile"),$(".select-character").show(),$(".new-character-button").show()):($(".nav-login-btn").html("Sign In"),$(".select-character").hide(),$(".new-character-button").hide())}function D(){$('input[name="hair-colour"]').each(function(){let t=$(this).closest("label").find("span").html();$(this).val(t)}),$('input[name="hair-style"]').each(function(){let t=$(this).closest("label").find("span").html();$(this).val(t)}),$('input[name="Eye-Colour"]').each(function(){let t=$(this).closest("label").find("span").html();$(this).val(t)}),$('input[name="skin-tone"]').each(function(){let t=$(this).closest("label").find("span").html();$(this).val(t)})}function x(){$(".character-preview-hair-item").each(function(){let t=$(this).find(".character-hair-label").text();$(this).find(".hair").addClass(t)})}function O(){$(".book-controls").each(function(){let t=$(this).attr("id").slice(0,-9);console.log("book-controls-id",t),t===selectedBook?$(this).css("display","flex"):$(this).hide()})}function h(t){let{length:e}=$(t);return Math.floor(Math.random()*e)}function p(t){$("#step-"+formStep+"-button").prop("disabled",!1).removeClass("selected-form-step"),$(t).prop("disabled",!0).addClass("selected-form-step")}function c(){let t=n(),e=f(t),r=$(".w-dropdown-list");r.empty(),e.then(o=>{o=$.parseJSON(o),$.each(o.records,function(){r.append(`<a href="#" class="w-dropdown-link character-dropdown-link" tabindex="0" id="${this.id}">${this.fields.NAME}</a>`)})})}function f(t){var e=new Headers;e.append("Content-Type","application/json");var r={method:"get",headers:e,redirect:"follow"};return fetch(`https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters&filterByFormula=USER_EMAIL="${t}"&t=${Date.now()}`,r).then(a=>a.text()).then(a=>a).catch(a=>console.log("error",a))}function g(t){let e=t||sessionStorage.getItem("currentCharacterId"),r=new Headers;r.append("Content-Type","application/json");let o={method:"get",headers:r,redirect:"follow"};return fetch(`https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters&filterByFormula={RECORD_ID}="${e}"&t=${Date.now()}`,o).then(s=>s.json()).then(s=>s.records[0]).catch(s=>console.log("error",s))}function A(){let t=[{CHARACTER_ID:sessionStorage.getItem("currentCharacterId"),BOOK_ID:"03",SESSION_ID:localStorage.getItem("sessionId"),USER_EMAIL:n()}],e=new Headers;e.append("Content-Type","application/json");let r={method:"post",headers:e,redirect:"follow",body:JSON.stringify(t)};fetch("https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Previews",r).then(o=>o.json()).catch(o=>console.log("error",o))}function u(){let t=[{NAME:$("#hero-name-input").val(),USER_EMAIL:n(),HAIR:styleColourId,EYES:eyesId,SKIN:skinToneId}],e=new Headers;e.append("Content-Type","application/json");let r={method:"post",headers:e,redirect:"follow",body:JSON.stringify(t)};return fetch("https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters",r).then(a=>a.json()).then(a=>(c(a[0]),sessionStorage.setItem("currentCharacterId",a[0].fields.RECORD_ID),a[0])).catch(a=>console.log("error",a))}function C(){let t=[{id:sessionStorage.getItem("currentCharacterId"),fields:{NAME:$("#hero-name-input").val(),USER_EMAIL:n(),HAIR:styleColourId,EYES:eyesId,SKIN:skinToneId}}],e=new Headers;e.append("Content-Type","application/json");let r={method:"put",headers:e,redirect:"follow",body:JSON.stringify(t)};fetch("https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters",r).then(o=>o.json()).then(o=>console.log("res",o)).catch(o=>console.log("error",o))}function l(){hairColour=$("input[name=hair-colour]:checked","#character-creation-form").val().toLowerCase(),$("input[name=hair-style]").each(function(t){let e=$(this).val().substring(6).toLowerCase();$(this).closest("div").addClass("hairstyle-"+t),e!==hairColour&&$(".hairstyle-"+t).hide(),e===hairColour&&$(".hairstyle-"+t).show()})}function I(){styleColourId=hairstyleId+"-"+hairColour.toLowerCase()}function d(){I(),$('input[value="'+styleColourId+'"]').prop("checked",!0)}function N(){let t=Snipcart.store.getState().customer.status==="SignedIn",e="";if(t){let r=n();f(r).then(a=>{if(a=$.parseJSON(a),c(),a.records.length>0){let s=a.records.reduce((k,v)=>k.fields.MODIFIED_AT>v.fields.MODIFIED_AT?k:v);w(s.fields)}})}else e=g(),e.then(r=>{w(r.fields)})}function w(t){sessionStorage.setItem("currentCharacterName",t.NAME),sessionStorage.setItem("currentCharacterId",t.RECORD_ID);let e=t.HAIR.split("-");$("input[value="+e[1]+"]").prop("checked",!0),$("input[value="+t.HAIR+"]").prop("checked",!0),$("input[value="+t.EYES+"]").prop("checked",!0),$("input[value="+t.SKIN+"]").prop("checked",!0),$("#hero-name-input").val(t.NAME),getSelectedStyles(),l(),d(),i()}function H(){$(".name-input").val(""),b(),getSelectedStyles(),l(),d(),i(),u(),c()}function T(){if(Snipcart.store.getState().customer.status==="SignedIn"){let e=sessionStorage.getItem("currentCharacterId");sessionStorage.setItem("currentCharacterName",$("#hero-name-input").val()),e===null?u():C(),c()}else $(".alert-banner").show(),$(".alert-banner").innerHtml("blallals")}function i(){if(styleColourId)$(".hair:visible").first().hide(),$("."+styleColourId).show();else{let{length:t}=$(".hair-container img"),e=Math.floor(Math.random()*t);$(".hair-container img").eq(e).show()}if(eyesId)$(".eyes:visible").first().hide(),$("."+eyesId).show();else{let{length:t}=$(".eyes-container img"),e=Math.floor(Math.random()*t);$(".eyes-container img").eq(e).show()}if(skinToneId)$(".skin:visible").first().hide(),$("."+skinToneId).show();else{let{length:t}=$(".skin-container img"),e=Math.floor(Math.random()*t);$(".skin-container img").eq(e).show()}}function b(){$(".name-input").val("");let t=h('input[name="hair-colour"]'),e=h('input[name="hair-style"]'),r=h('input[name="Eye-Colour"]'),o=h('input[name="skin-tone"]');$('input[name="hair-colour"]').eq(t).prop("checked",!0),$('input[name="hair-style"]').eq(e).prop("checked",!0),$('input[name="Eye-Colour"]').eq(r).prop("checked",!0),$('input[name="skin-tone"]').eq(o).prop("checked",!0)}function M(){return localStorage.getItem("sessionId")}function R(){if(M()===null){let t=uuidv4();localStorage.setItem("sessionId",t)}}window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{window.formStep=1,window.hairstyleId="",window.hairColour="",window.styleColourId=hairstyleId+"-"+hairColour,window.eyesId="",window.skinToneId="",window.userId="",window.sessionId="",window.sessionRow="",window.selectedBook="",window.currentCharacterName="";let t=new MasterPlan(document.getElementById("masterplan"),{clientID:"5140",jobID:"2000",theme:"light",embedType:"frame",thumbWidth:"300",autoFullscreen:!0,showLoginLink:!1,clientNameLink:!1,showSpreadNums:!1,customCss:{nestedToc:!0}});window.onload=function(){Snipcart.events.on("snipcart.initialized",e=>{$(".book-preview-container").hide(),$(".loading-section").hide(),E(),p("#step-1-button"),D(),x(),randomiseOrLoadCharacter(),setTimeout(function(){document.getElementsByTagName("html")[0].style.visibility="visible"},500)})},window.randomiseOrLoadCharacter=function(){let e=Snipcart.store.getState().customer.status==="SignedIn";sessionStorage.getItem("currentCharacterId")===null&&!e?(b(),getSelectedStyles(),l(),d(),i()):N()},$(".save-character-button").click(function(e){e.stopPropagation(),e.preventDefault(),T()}),$(".new-character-button").click(function(e){e.preventDefault(),e.stopPropagation(),H()}),$(".w-dropdown-list").on("click",".character-dropdown-link",function(e){e.preventDefault(),e.stopPropagation();let r=$(this).attr("id");g(r).then(a=>{w(a.fields)})}),$("#step-1-button").click(function(e){e.preventDefault(),p("#step-1-button"),$(".form-step-1-container").fadeIn("slow"),$(".form-step-"+formStep+"-container").css({display:"none"}),$("<style>[type=radio]:checked + img { outline: 5px solid #F080B2;}</style>").appendTo("head"),formStep=1}),$("#step-2-button").click(function(e){e.preventDefault(),p("#step-2-button"),$(".form-step-2-container").fadeIn("slow"),$(".form-step-"+formStep+"-container").css({display:"none"}),$("<style>[type=radio]:checked + img { outline: 5px solid #01AFDA;}</style>").appendTo("head"),formStep=2}),$("#step-3-button").click(function(e){e.preventDefault(),p("#step-3-button"),$(".form-step-3-container").fadeIn("slow"),$(".form-step-"+formStep+"-container").css({display:"none"}),$("<style>[type=radio]:checked + img { outline: 5px solid #77B82A;}</style>").appendTo("head"),formStep=3}),$('input[name="hair-colour"]').change(function(e){l(),d(),I(),i()}),$("input[name=hair-style]").change(function(e){getSelectedStyles(),I(),i()}),$("input[name=Eye-Colour]").change(function(e){eyesId=$("input[name=Eye-Colour]:checked","#character-creation-form").val().toLowerCase(),i()}),$("input[name=skin-tone]").change(function(e){skinToneId=$("input[name=skin-tone]:checked","#character-creation-form").val().toLowerCase(),i()}),window.getSelectedStyles=function(){let r=$("input[name=hair-style]:checked","#character-creation-form").val();hairstyleId=r.slice(0,5),eyesId=$("input[name=Eye-Colour]:checked","#character-creation-form").val().toLowerCase(),skinToneId=$("input[name=skin-tone]:checked","#character-creation-form").val().toLowerCase()},$(".pick-a-book").click(function(e){e.preventDefault();let r=sessionStorage.getItem("currentCharacterId");sessionStorage.setItem("currentCharacterName",$("#hero-name-input").val()),r===null?u():C(),$(".character-builder-container").hide(),$(".book-selector-container").show()}),$(".edit-character-button").click(function(e){e.preventDefault(),$(".character-builder-container").show(),$(".book-selector-container").hide()}),$(".book-container").each(function(){let e=$(this).closest("div").find(".book-title").html().toLowerCase().replace(/ /g,"-");$(this).prop("id",e+"-book")}),$(".book-container-large").each(function(){let e=$(this).closest("div").find(".book-title").html().toLowerCase().replace(/ /g,"-");$(this).prop("id","large-"+e)}),$(".story-back-button").click(function(e){e.preventDefault(),e.stopPropagation(),$(".book-small-list-container").css("display","flex"),$(".book-container-large").hide()}),$(".book-container").click(function(e){e.preventDefault(),selectedBook=$(this).prop("id").slice(0,-5),console.log(selectedBook),$(".book-small-list-container").hide(),$(".book-container-large").each(function(){let r="large-"+selectedBook;$(this).attr("id")===r?$(this).css("display","flex"):$(this).hide()})}),$(".see-your-story-button").click(function(e){e.preventDefault(),R(),O(),$(".add-to-cart-btn").attr("data-item-custom1-value",window.sessionStorage.getItem("currentCharacterName")),A(),$(".book-preview-container").css("display","flex"),$(".book-selector-container").hide()}),$(".edit-character").click(function(e){e.preventDefault(),$(".book-preview-container").hide(),$(".character-builder-container").show()}),$(".select-story").click(function(e){e.preventDefault(),$(".book-preview-container").hide(),$(".book-selector-container").show()})});})();
