"use strict";(()=>{function i(){return Snipcart.store.getState().customer.status==="SignedIn"?Snipcart.store.getState().customer.email:""}function R(){Snipcart.store.getState().customer.status==="SignedIn"?($(".nav-login-btn").html("Profile"),$(".select-character").show(),$(".new-character-button").show()):($(".nav-login-btn").html("Sign In"),$(".select-character").hide(),$(".new-character-button").hide())}function U(){$('input[name="hair-colour"]').each(function(){let t=$(this).closest("label").find("span").html();$(this).val(t)}),$('input[name="hair-style"]').each(function(){let t=$(this).closest("label").find("span").html();$(this).val(t)}),$('input[name="Eye-Colour"]').each(function(){let t=$(this).closest("label").find("span").html();$(this).val(t)}),$('input[name="skin-tone"]').each(function(){let t=$(this).closest("label").find("span").html();$(this).val(t)})}function M(){$(".character-preview-hair-item").each(function(){let t=$(this).find(".character-hair-label").text();$(this).find(".hair").addClass(t)})}function B(){$(".book-controls").each(function(){$(this).attr("id").slice(0,-9)===selectedBook?$(this).css("display","flex"):$(this).hide()})}function h(t){let{length:e}=$(t);return Math.floor(Math.random()*e)}function m(t){$("#step-"+formStep+"-button").prop("disabled",!1).removeClass("selected-form-step"),$(t).prop("disabled",!0).addClass("selected-form-step")}function f(){let t=i(),e=I(t),r=$(".w-dropdown-list");r.empty(),e.then(o=>{o=$.parseJSON(o),$.each(o.records,function(){r.append(`<a href="#" class="w-dropdown-link character-dropdown-link" tabindex="0" id="${this.id}">${this.fields.NAME}</a>`)})})}function I(t){var e=new Headers;e.append("Content-Type","application/json");var r={method:"get",headers:e,redirect:"follow"};return fetch(`https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters&filterByFormula=USER_EMAIL="${t}"&t=${Date.now()}`,r).then(n=>n.text()).then(n=>n).catch(n=>console.log("error",n))}function C(t){let e=t||sessionStorage.getItem("currentCharacterId"),r=new Headers;r.append("Content-Type","application/json");let o={method:"get",headers:r,redirect:"follow"};return fetch(`https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters&filterByFormula={RECORD_ID}="${e}"&t=${Date.now()}`,o).then(a=>a.json()).then(a=>a.records[0]).catch(a=>console.log("error",a))}function q(){let t=[{CHARACTER_ID:sessionStorage.getItem("currentCharacterId"),BOOK_ID:window.selectedBook,SESSION_ID:localStorage.getItem("sessionId"),USER_EMAIL:i()}],e=new Headers;e.append("Content-Type","application/json");let r={method:"post",headers:e,redirect:"follow",body:JSON.stringify(t)};fetch("https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Previews",r).then(o=>o.json()).catch(o=>console.log("error",o))}function w(){let t=[{NAME:$("#hero-name-input").val(),USER_EMAIL:i(),HAIR:styleColourId,EYES:eyesId,SKIN:skinToneId,PRONOUNS:window.pronouns,LANGUAGE:window.language}],e=new Headers;e.append("Content-Type","application/json");let r={method:"post",headers:e,redirect:"follow",body:JSON.stringify(t)};return fetch("https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters",r).then(n=>n.json()).then(n=>(f(),sessionStorage.setItem("currentCharacterId",n[0].fields.RECORD_ID),n[0])).catch(n=>console.log("error",n))}function g(){let t=[{id:sessionStorage.getItem("currentCharacterId"),fields:{NAME:$("#hero-name-input").val(),USER_EMAIL:i(),HAIR:styleColourId,EYES:eyesId,SKIN:skinToneId,PRONOUNS:window.pronouns,LANGUAGE:window.language}}],e=new Headers;e.append("Content-Type","application/json");let r={method:"put",headers:e,redirect:"follow",body:JSON.stringify(t)};fetch("https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters",r).then(o=>o.json()).then(o=>console.log("res",o)).catch(o=>console.log("error",o))}function u(){hairColour=$("input[name=hair-colour]:checked","#character-creation-form").val().toLowerCase(),$(".hair-collection-wrapper").each(function(){$(this).attr("class").includes(hairColour)?$(this).show():$(this).hide()})}function S(){styleColourId=hairstyleId+"-"+hairColour.toLowerCase()}function p(t){S(),$('input[value="'+styleColourId+'"]').prop("checked",!0),t&&t()}function k(){document.getElementById("loading-screen").style.display="none"}var b,v,N,j;window.numberPerPage;var D;window.currentPage=1;window.numberOfPages;function W(){b=document.querySelectorAll(".hair-collection-wrapper.black .hair-style-container"),v=document.querySelectorAll(".hair-collection-wrapper.blonde .hair-style-container"),N=document.querySelectorAll(".hair-collection-wrapper.brown .hair-style-container"),j=b.length,window.numberOfPages=Math.ceil(j/window.numberPerPage)}function Y(){window.hairColour==="black"&&b.forEach((t,e)=>{t.querySelector('input[name="hair-style"]').checked&&(D=e)}),window.hairColour==="blonde"&&v.forEach((t,e)=>{t.querySelector('input[name="hair-style"]').checked&&(D=e)}),window.currentPage=Math.ceil((D+1)/9)}function c(t){W(),t||Y();let e=(window.currentPage-1)*window.numberPerPage,r=e+window.numberPerPage;var o=Array.prototype.slice.call(b,e,r),n=Array.prototype.slice.call(v,e,r),a=Array.prototype.slice.call(N,e,r);function l(P){[].forEach.call(P,function(x){x.style.display="block"})}function d(P){[].forEach.call(P,function(x){x.style.display="none"})}d(b),d(v),d(N),l(o),l(n),l(a)}function J(){let t=Snipcart.store.getState().customer.status==="SignedIn",e="";if(t){let r=i();I(r).then(n=>{if(n=$.parseJSON(n),f(),n.records.length>0){let a=n.records.reduce((l,d)=>l.fields.MODIFIED_AT>d.fields.MODIFIED_AT?l:d);E(a.fields)}})}else e=C(),e.then(r=>{E(r.fields)})}function E(t){sessionStorage.setItem("currentCharacterName",t.NAME),sessionStorage.setItem("currentCharacterId",t.RECORD_ID);let e=t.HAIR.split("-");$("input[value="+e[1]+"]").prop("checked",!0),$("input[value="+t.HAIR+"]").prop("checked",!0),$("input[value="+t.EYES+"]").prop("checked",!0),$("input[value="+t.SKIN+"]").prop("checked",!0),$("#hero-name-input").val(t.NAME),getSelectedStyles(),u(),p(function(){c()}),s(function(){k()})}function L(){$(".name-input").val(""),H(),window.getSelectedStyles(),u(),p(function(){c()}),s(),w()}function G(){if(Snipcart.store.getState().customer.status==="SignedIn"){let e=sessionStorage.getItem("currentCharacterId");sessionStorage.setItem("currentCharacterName",$("#hero-name-input").val()),e===null?w():g(),f()}else $(".alert-banner").show(),$(".alert-banner").innerHtml("blallals")}function s(t){if(styleColourId)$(".hair:visible").first().hide(),$("."+styleColourId).show();else{let{length:e}=$(".hair-container img"),r=Math.floor(Math.random()*e);$(".hair-container img").eq(r).show()}if(eyesId)$(".eyes:visible").first().hide(),$("."+eyesId).show();else{let{length:e}=$(".eyes-container img"),r=Math.floor(Math.random()*e);$(".eyes-container img").eq(r).show()}if(skinToneId)$(".skin:visible").first().hide(),$("."+skinToneId).show();else{let{length:e}=$(".skin-container img"),r=Math.floor(Math.random()*e);$(".skin-container img").eq(r).show()}t&&t()}function H(){$(".name-input").val("");let t=h('input[name="hair-colour"]'),e=h('input[name="hair-style"]'),r=h('input[name="Eye-Colour"]'),o=h('input[name="skin-tone"]');$('input[name="hair-colour"]').eq(t).prop("checked",!0),$('input[name="hair-style"]').eq(e).prop("checked",!0),$('input[name="Eye-Colour"]').eq(r).prop("checked",!0),$('input[name="skin-tone"]').eq(o).prop("checked",!0)}function Q(){return localStorage.getItem("sessionId")}function K(){if(Q()===null){let t=uuidv4();localStorage.setItem("sessionId",t)}}function T(){$(".book-preview-container").hide(),$(".book-selector-container").hide(),$(".book-container-large").hide(),$(".character-builder-container").show()}window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{window.formStep=1,window.hairstyleId="",window.hairColour="",window.styleColourId=hairstyleId+"-"+hairColour,window.eyesId="",window.skinToneId="",window.userId="",window.sessionId="",window.sessionRow="",window.selectedBook="",window.currentCharacterName="",window.pronouns="",window.language="",$(document).ready(function(){var e=200,r=!0,o=function(){r&&(window.innerWidth<=767?window.numberPerPage=3:window.numberPerPage=9,c(),r=!1)},n=setInterval(o,e);o(),$(window).resize(function(){r=!0})});let t=new MasterPlan(document.getElementById("masterplan"),{clientID:"5140",jobID:"2000",theme:"light",embedType:"frame",thumbWidth:"300",autoFullscreen:!0,showLoginLink:!1,clientNameLink:!1,showSpreadNums:!1,customCss:{nestedToc:!0}});window.onload=function(){Snipcart.events.on("snipcart.initialized",e=>{T(),R(),m("#step-1-button"),U(),M(),randomiseOrLoadCharacter()})},window.randomiseOrLoadCharacter=function(){let e=Snipcart.store.getState().customer.status==="SignedIn";sessionStorage.getItem("currentCharacterId")===null&&!e?(H(),window.getSelectedStyles(),u(),p(function(){c()}),s(function(){k()})):J()},$("#next-pagination-button").click(function(){window.currentPage!==window.numberOfPages&&(window.currentPage+=1,c(window.currentPage))}),$("#prev-pagination-button").click(function(){window.currentPage!==1&&(window.currentPage-=1,c(window.currentPage))}),$(".save-character-button").click(function(e){e.stopPropagation(),e.preventDefault(),G()}),$(".new-character-button").click(function(e){e.preventDefault(),e.stopPropagation(),L()}),$(".w-dropdown-list").on("click",".character-dropdown-link",function(e){e.preventDefault(),e.stopPropagation();let r=$(this).attr("id");C(r).then(n=>{E(n.fields)})}),$(".pronoun-radio-button").click(function(){window.pronouns=$(this).val()}),$(".language-radio-button").click(function(){window.language=$(this).val()}),$("#step-1-button").click(function(e){e.preventDefault(),m("#step-1-button"),$(".form-step-1-container").fadeIn("slow"),$(".form-step-"+formStep+"-container").css({display:"none"}),$("<style>[type=radio]:checked + img { outline: 5px solid #F080B2;}</style>").appendTo("head"),formStep=1}),$("#step-2-button").click(function(e){e.preventDefault(),m("#step-2-button"),$(".form-step-2-container").fadeIn("slow"),$(".form-step-"+formStep+"-container").css({display:"none"}),$("<style>[type=radio]:checked + img { outline: 5px solid #01AFDA;}</style>").appendTo("head"),formStep=2}),$("#step-3-button").click(function(e){e.preventDefault(),m("#step-3-button"),$(".form-step-3-container").fadeIn("slow"),$(".form-step-"+formStep+"-container").css({display:"none"}),$("<style>[type=radio]:checked + img { outline: 5px solid #77B82A;}</style>").appendTo("head"),formStep=3}),$('input[name="hair-colour"]').change(function(e){u(),p(),S(),s()}),$("input[name=hair-style]").change(function(e){getSelectedStyles(),S(),s()}),$("input[name=Eye-Colour]").change(function(e){eyesId=$("input[name=Eye-Colour]:checked","#character-creation-form").val().toLowerCase(),s()}),$("input[name=skin-tone]").change(function(e){skinToneId=$("input[name=skin-tone]:checked","#character-creation-form").val().toLowerCase(),s()}),window.getSelectedStyles=function(){let r=$("input[name=hair-style]:checked","#character-creation-form").val();hairstyleId=r.slice(0,5),eyesId=$("input[name=Eye-Colour]:checked","#character-creation-form").val().toLowerCase(),skinToneId=$("input[name=skin-tone]:checked","#character-creation-form").val().toLowerCase()},$(".pick-a-book").click(function(e){e.preventDefault();let r=sessionStorage.getItem("currentCharacterId");sessionStorage.setItem("currentCharacterName",$("#hero-name-input").val()),r===null?w():g(),$(".character-builder-container").hide(),$(".book-selector-container").show()}),$(".edit-character-button").click(function(e){e.preventDefault(),$(".character-builder-container").show(),$(".book-selector-container").hide()}),$(".book-container").each(function(){let e=$(this).closest("div").find(".book-title").html().toLowerCase().replace(/ /g,"-");$(this).prop("id",e+"-book")}),$(".book-container").click(function(e){e.preventDefault(),selectedBook=$(this).prop("id").slice(0,-5),$(".book-small-list-container").hide(),$(".book-container-large").each(function(){console.log(selectedBook);let r="large-"+selectedBook;$(this).attr("id")===r?$(this).css("display","flex"):$(this).hide()})}),$(".book-container-large").each(function(){let e=$(this).closest("div").find(".book-title").html().toLowerCase().replace(/ /g,"-");$(this).prop("id","large-"+e)}),$(".story-back-button").click(function(e){e.preventDefault(),e.stopPropagation(),$(".book-small-list-container").css("display","flex"),$(".book-container-large").hide()}),$(".see-your-story-button").click(function(e){e.preventDefault(),K(),B(),$(".add-to-cart-btn").attr("data-item-custom1-value",window.sessionStorage.getItem("currentCharacterName")),q(),g(),$(".book-preview-container").css("display","flex"),$(".book-selector-container").hide()}),$(".edit-character").click(function(e){e.preventDefault(),$(".book-preview-container").hide(),$(".character-builder-container").show()}),$(".select-story").click(function(e){e.preventDefault(),$(".book-preview-container").hide(),$(".book-selector-container").show()}),$(".add-to-cart-btn").click(function(e){T(),L()})});})();
