"use strict";(()=>{window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{window.formStep=1,window.hairstyleId="",window.hairColour="",window.styleColourId=hairstyleId+"-"+hairColour,window.eyesId="",window.skinToneId="",window.userId="",window.sessionId="",window.sessionRow="",window.selectedBook="",window.currentCharacterName="";let k=new MasterPlan(document.getElementById("masterplan"),{clientID:"5140",jobID:"2000",theme:"light",embedType:"frame",thumbWidth:"300",autoFullscreen:!0,showLoginLink:!1,clientNameLink:!1,showSpreadNums:!1,customCss:{nestedToc:!0}});window.onload=function(){Snipcart.events.on("snipcart.initialized",e=>{if($(".book-preview-container").hide(),$(".loading-section").hide(),p(),i("#step-1-button"),m(),f(),sessionStorage.getItem("currentCharacterId")===null){let t=a('input[name="hair-colour"]'),o=a('input[name="hair-style"]'),n=a('input[name="Eye-Colour"]'),h=a('input[name="skin-tone"]');$('input[name="hair-colour"]').eq(t).prop("checked",!0),$('input[name="hair-style"]').eq(o).prop("checked",!0),$('input[name="Eye-Colour"]').eq(n).prop("checked",!0),$('input[name="skin-tone"]').eq(h).prop("checked",!0),getSelectedStyles(),displaySelectedColour(),checkSelectedHairstyle(),renderCharacter()}else buildUserCharacter();setTimeout(function(){document.getElementsByTagName("html")[0].style.visibility="visible"},500)})},$(".save-character-button").click(function(e){e.stopPropagation(),e.preventDefault(),u()});function u(){if(Snipcart.store.getState().customer.status==="SignedIn"){let t=sessionStorage.getItem("currentCharacterId");sessionStorage.setItem("currentCharacterName",$("#hero-name-input").val()),t===null?l():d()}else $(".alert-banner").show(),$(".alert-banner").innerHtml("blallals")}function p(){Snipcart.store.getState().customer.status==="SignedIn"?$(".nav-login-btn").html("Profile"):$(".nav-login-btn").html("Sign In")}$("#step-1-button").click(function(e){e.preventDefault(),i("#step-1-button"),$(".form-step-1-container").fadeIn("slow"),$(".form-step-"+formStep+"-container").css({display:"none"}),$("<style>[type=radio]:checked + img { outline: 5px solid #F080B2;}</style>").appendTo("head"),formStep=1}),$("#step-2-button").click(function(e){e.preventDefault(),i("#step-2-button"),$(".form-step-2-container").fadeIn("slow"),$(".form-step-"+formStep+"-container").css({display:"none"}),$("<style>[type=radio]:checked + img { outline: 5px solid #01AFDA;}</style>").appendTo("head"),formStep=2}),$("#step-3-button").click(function(e){e.preventDefault(),i("#step-3-button"),$(".form-step-3-container").fadeIn("slow"),$(".form-step-"+formStep+"-container").css({display:"none"}),$("<style>[type=radio]:checked + img { outline: 5px solid #77B82A;}</style>").appendTo("head"),formStep=3}),window.buildUserCharacter=function(){getRecord().then(o=>{sessionStorage.setItem("currentCharacterName",o.fields.NAME);let n=o.fields.HAIR.split("-");$("input[value="+n[1]+"]").prop("checked",!0),$("input[value="+o.fields.HAIR+"]").prop("checked",!0),$("input[value="+o.fields.EYES+"]").prop("checked",!0),$("input[value="+o.fields.SKIN+"]").prop("checked",!0),$("#hero-name-input").val(o.fields.NAME),getSelectedStyles(),displaySelectedColour(),checkSelectedHairstyle(),renderCharacter()})},window.renderCharacter=function(){if(styleColourId)$(".hair:visible").first().hide(),$("."+styleColourId).show();else{let{length:t}=$(".hair-container img"),o=Math.floor(Math.random()*t);$(".hair-container img").eq(o).show()}if(eyesId)$(".eyes:visible").first().hide(),$("."+eyesId).show();else{let{length:t}=$(".eyes-container img"),o=Math.floor(Math.random()*t);$(".eyes-container img").eq(o).show()}if(skinToneId)$(".skin:visible").first().hide(),$("."+skinToneId).show();else{let{length:t}=$(".skin-container img"),o=Math.floor(Math.random()*t);$(".skin-container img").eq(o).show()}};function m(){$('input[name="hair-colour"]').each(function(){let e=$(this).closest("label").find("span").html();$(this).val(e)}),$('input[name="hair-style"]').each(function(){let e=$(this).closest("label").find("span").html();$(this).val(e)}),$('input[name="Eye-Colour"]').each(function(){let e=$(this).closest("label").find("span").html();$(this).val(e)}),$('input[name="skin-tone"]').each(function(){let e=$(this).closest("label").find("span").html();$(this).val(e)})}function f(){$(".character-preview-hair-item").each(function(){let e=$(this).find(".character-hair-label").text();console.log(e),$(this).find(".hair").addClass(e)})}function y(){$(".book-controls").each(function(){$(this).attr("id")===selectedBook?$(this).css("display","flex"):$(this).hide()})}function a(e){let{length:t}=$(e);return Math.floor(Math.random()*t)}function i(e){$("#step-"+formStep+"-button").prop("disabled",!1).removeClass("selected-form-step"),$(e).prop("disabled",!0).addClass("selected-form-step")}$('input[name="hair-colour"]').change(function(e){displaySelectedColour(),checkSelectedHairstyle(),s(),renderCharacter()}),$("input[name=hair-style]").change(function(e){getSelectedStyles(),s(),renderCharacter()}),$("input[name=Eye-Colour]").change(function(e){eyesId=$("input[name=Eye-Colour]:checked","#character-creation-form").val().toLowerCase(),renderCharacter()}),$("input[name=skin-tone]").change(function(e){skinToneId=$("input[name=skin-tone]:checked","#character-creation-form").val().toLowerCase(),renderCharacter()}),window.displaySelectedColour=function(){hairColour=$("input[name=hair-colour]:checked","#character-creation-form").val().toLowerCase(),$("input[name=hair-style]").each(function(t){let o=$(this).val().substring(6).toLowerCase();$(this).closest("div").addClass("hairstyle-"+t),o!==hairColour&&$(".hairstyle-"+t).hide(),o===hairColour&&$(".hairstyle-"+t).show()})};function s(){styleColourId=hairstyleId+"-"+hairColour.toLowerCase()}window.checkSelectedHairstyle=function(){s(),$('input[value="'+styleColourId+'"]').prop("checked",!0)},window.getSelectedStyles=function(){let t=$("input[name=hair-style]:checked","#character-creation-form").val();hairstyleId=t.slice(0,5),eyesId=$("input[name=Eye-Colour]:checked","#character-creation-form").val().toLowerCase(),skinToneId=$("input[name=skin-tone]:checked","#character-creation-form").val().toLowerCase()},$(".pick-a-book").click(function(e){e.preventDefault();let t=sessionStorage.getItem("currentCharacterId");sessionStorage.setItem("currentCharacterName",$("#hero-name-input").val()),t===null?l():d(),$(".character-builder-container").hide(),$(".book-selector-container").show()}),$(".edit-character-button").click(function(e){e.preventDefault(),$(".character-builder-container").show(),$(".book-selector-container").hide()}),$(".book-container").each(function(){let e=$(this).closest("div").find(".book-title").html().toLowerCase().replace(/ /g,"-");$(this).prop("id",e)}),$(".book-container-large").each(function(){let e=$(this).closest("div").find(".book-title").html().toLowerCase().replace(/ /g,"-");$(this).prop("id","large-"+e)}),$(".story-back-button").click(function(e){e.preventDefault(),e.stopPropagation(),$(".book-small-list-container").css("display","flex"),$(".book-container-large").hide()}),$(".book-container").click(function(e){e.preventDefault(),selectedBook=$(this).prop("id"),$(".book-small-list-container").hide(),$(".book-container-large").each(function(){let t="large-"+selectedBook;$(this).attr("id")===t?$(this).css("display","flex"):$(this).hide()})}),$(".see-your-story-button").click(function(e){e.preventDefault(),g(),y(),C(),$(".book-preview-container").css("display","flex"),$(".book-selector-container").hide()}),$(".edit-character").click(function(e){e.preventDefault(),$(".book-preview-container").hide(),$(".character-builder-container").show()}),$(".select-story").click(function(e){e.preventDefault(),$(".book-preview-container").hide(),$(".book-selector-container").show()});function I(){return localStorage.getItem("sessionId")}function g(){if(I()===null){let e=uuidv4();localStorage.setItem("sessionId",e)}}function c(){return Snipcart.store.getState().customer.status==="SignedIn"?Snipcart.store.getState().customer.email:""}window.getRecord=function(){let t=sessionStorage.getItem("currentCharacterId"),o=new Headers;o.append("Content-Type","application/json");let n={method:"get",headers:o,redirect:"follow"};return fetch(`https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters&filterByFormula={RECORD_ID}="${t}"`,n).then(r=>r.json()).then(r=>r.records[0]).catch(r=>console.log("error",r))};function C(){let e=[{CHARACTER_ID:sessionStorage.getItem("currentCharacterId"),BOOK:"03",SESSION_ID:localStorage.getItem("sessionId"),USER_EMAIL:c()}],t=new Headers;t.append("Content-Type","application/json");let o={method:"post",headers:t,redirect:"follow",body:JSON.stringify(e)};fetch("https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Sessions",o).then(n=>n.json()).catch(n=>console.log("error",n))}function l(){let e=[{NAME:$("#hero-name-input").val(),USER_EMAIL:c(),HAIR:styleColourId,EYES:eyesId,SKIN:skinToneId}],t=new Headers;t.append("Content-Type","application/json");let o={method:"post",headers:t,redirect:"follow",body:JSON.stringify(e)};fetch("https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters",o).then(n=>n.json()).then(n=>{sessionStorage.setItem("currentCharacterId",n[0].fields.RECORD_ID)}).catch(n=>console.log("error",n))}function d(){let e=[{id:sessionStorage.getItem("currentCharacterId"),fields:{NAME:$("#hero-name-input").val(),USER_EMAIL:c(),HAIR:styleColourId,EYES:eyesId,SKIN:skinToneId}}],t=new Headers;t.append("Content-Type","application/json");let o={method:"put",headers:t,redirect:"follow",body:JSON.stringify(e)};fetch("https://v1.nocodeapi.com/makebelieveme/airtable/nmeOnHAeFloOUpCL?tableName=Characters",o).then(n=>n.json()).catch(n=>console.log("error",n))}});})();
